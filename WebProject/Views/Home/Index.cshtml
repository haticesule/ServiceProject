@{
    ViewData["Title"] = "Customer Page";
    Layout = null;
}


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head runat="server">
    <title></title>
</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    @@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
    }

    body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #cfd8dc;
        background: -moz-linear-gradient( -45deg, #cfd8dc 0%, #607d8b 100%, #b0bec5 100% );
        background: -webkit-linear-gradient( -45deg, #cfd8dc 0%, #607d8b 100%, #b0bec5 100% ); 
        background: linear-gradient( 135deg, #cfd8dc 0%, #607d8b 100%, #b0bec5 100% ); 
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#cfd8dc', endColorstr='#b0bec5',GradientType=1 );
    }

    .container {
        position: relative;
        max-width: 900px;
        width: 100%;
        border-radius: 6px;
        padding: 30px;
        margin: auto;
        margin-top: 6rem;
        background-color: #EEEEEE;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    }

    .container header {
        position: relative;
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }

    .container header::before {
        content: "";
        position: absolute;
        left: 0;
        bottom: -2px;
        height: 3px;
        width: 27px;
        border-radius: 8px;
        ackground-color: #141e30;
    }

    .container form {
        position: relative;
        margin-top: 16px;
        min-height: 490px;
            background-color: #EEEEEE;
        overflow: hidden;
    }

    .container form .form {
        position: absolute;
        background-color: #EEEEEE;
        transition: 0.3s ease;
    }

    .container form .form.second {
        opacity: 0;
        pointer-events: none;
        transform: translateX(100%);
    }

    form.secActive .form.second {
        opacity: 1;
        pointer-events: auto;
        transform: translateX(0);
    }

    form.secActive .form.first {
        opacity: 0;
        pointer-events: none;
        transform: translateX(-100%);
    }

    .container form .title {
        display: block;
        margin-bottom: 8px;
        font-size: 16px;
        font-weight: 500;
        margin: 6px 0;
        color: #333;
    }

    .container form .fields {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    form .fields .input-field {
        display: flex;
        width: calc(100% / 3 - 15px);
        flex-direction: column;
        margin: 4px 0;
    }

    .input-field label {
        font-size: 12px;
        font-weight: 500;
        color: #2e2e2e;
    }

    .input-field input,
    select {
        outline: none;
        font-size: 14px;
        font-weight: 400;
        color: #333;
        border-radius: 5px;
        border: 1px solid #aaa;
        padding: 0 15px;
        height: 42px;
        margin: 8px 0;
    }

    .input-field input :focus,
    .input-field select:focus {
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.13);
    }

    .input-field select,
    .input-field input[type="date"] {
        color: #707070;
    }

    .input-field select {
        width: 100%;
        outline: none;
        font-size: 14px;
        font-weight: 400;
        color: #333;
        border-radius: 5px;
        border: 1px solid #aaa;
        padding: 0 15px;
        height: 42px;
        margin: 8px 0;
    }

    .input-field input[type="date"]:valid {
        color: #333;
    }

    form .fields .input-field2 {
        display: flex;
        width: calc(100% / 4 - 15px);
        flex-direction: column;
        margin: 4px 0;
    }

    .input-field2 label {
        font-size: 12px;
        font-weight: 500;
        color: #2e2e2e;
    }

    .input-field2 input,
    select {
        outline: none;
        font-size: 14px;
        font-weight: 400;
        color: #333;
        border-radius: 5px;
        border: 1px solid #aaa;
        padding: 0 15px;
        height: 42px;
        margin: 8px 0;
    }

        .input-field2 input :focus,
        .input-field2 select:focus {
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.13);
        }

        .input-field2 select,
        .input-field2 input[type="date"] {
            color: #707070;
        }

    .input-field2 select {
        width: 100%;
        outline: none;
        font-size: 14px;
        font-weight: 400;
        color: #333;
        border-radius: 5px;
        border: 1px solid #aaa;
        padding: 0 15px;
        height: 42px;
        margin: 8px 0;
    }

    .input-field2 input[type="date"]:valid {
        color: #333;
    }

    .container form button,
    .backBtn {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 45px;
        max-width: 200px;
        width: 100%;
        border: none;
        outline: none;
        color: #fff;
        border-radius: 5px;
        margin: 25px 0;
        background-color: #003366;
        transition: all 0.3s linear;
        cursor: pointer;
    }

    .container form .btnText {
        font-size: 14px;
        font-weight: 400;
    }

    form button:hover {
        background-color: #003366;
    }

    form button i,
    form .backBtn i {
        margin: 0 6px;
    }

    form .backBtn i {
        transform: rotate(180deg);
    }

    form .buttons {
        display: flex;
        align-items: center;
    }

    form .buttons button,
    .backBtn {
        margin-right: 14px;
    }

    @@media (max-width: 750px) {
        .container form {
            overflow-y: scroll;
        }

        .container form::-webkit-scrollbar {
            display: none;
        }

        form .fields .input-field {
            width: calc(100% / 2 - 15px);
        }
    }

    @@media (max-width: 550px) {
        form .fields .input-field {
            width: 100%;
        }
    }

    html {
        font-family: 'Josefin Slab', 'Comfortaa', sans-serif;
        font-size: 1.2em;
        background: #eeee;
    }
    body{
        display: block;
    }
    ul {
        position: relative;
        width: 27em;
        /* height: 0.5em; */
        margin: 0 auto;
        padding: 10px;
        white-space: nowrap;
    }

        ul li {
            display: inline;
            text-align: center;
        }

            ul li a {
                position: relative;
                top: 0;
                left: 0;
                right: 25em;
                bottom: 0;
                display: inline-block;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                padding: .2em .1em;
                color: #09C;
                text-decoration: none;
                text-shadow: 0 1px 0 white;
                -webkit-transition: width .3s,right .3s;
                -moz-transition: width .3s,right .3s;
                -o-transition: width .3s,right .3s;
                transition: width .3s,right .3s;
            }

            ul li:nth-child(1) a {
                width: 2em;
            }

            ul li:nth-child(2) a {
                width: 4em;
            }

            ul li:nth-child(3) a {
                width: 4em;
            }

            ul li:nth-child(4) a {
                width: 7em;
            }

            ul li:nth-child(5) a {
                width: 5em;
            }

            ul li:last-child a::after {
                content: "";
                position: absolute;
                right: inherit;
                bottom: -3px;
                width: inherit;
                height: 3px;
                background: #ccc;
                pointer-events: none;
                -webkit-transition: all .5s ease;
                -moz-transition: all .5s ease;
                -o-transition: all .5s ease;
                transition: all .5s ease;
            }

            ul li:nth-child(1) ~ li:last-child a {
                right: 21em;
                width: 2em;
            }

            ul li:nth-child(2):hover ~ li:last-child a {
                right: 17em;
                width: 4em;
            }

            ul li:nth-child(3):hover ~ li:last-child a {
                right: 13em;
                width: 4em;
            }

            ul li:nth-child(4):hover ~ li:last-child a {
                right: 6em;
                width: 7em;
            }

            ul li:nth-child(5):last-child:hover a {
                right: 0;
                width: 5em;
            }

            ul li:hover ~ li:last-child a::after,
            ul li:last-child:hover a::after {
                background: #65000b;
            }

            ul li:last-child a {
                min-width: 5em;
                max-width: 5em;
            }

            ul li a:hover,
            ul li a:focus {
                color: #65000b;
                background-color: rgba(255,255,255,.6);
                -webkit-transition: width .3s,right .3s,background-color .3s;
                -moz-transition: width .3s,right .3s,background-color .3s;
                -o-transition: width .3s,right .3s,background-color .3s;
                transition: width .3s,right .3s,background-color .3s;
            }

            ul li a:focus {
                border-bottom: 3px solid #65000b;
            }



    .navbar {
        text-align: center;
        margin: 0 auto;
        padding: 0px 0;
        background-color: #fff;
    }

    .navbar-title {
        font-size: 1.5em;
        margin: 0;
        padding: 0px 0;
        color: #09C;
    }

</style>

<body>
    <div class="navbar">
        <ul>
            <li><a href="#"> &#10047; </a></li>
            <li><a asp-controller="Home" asp-action="Driver"> Servis </a></li>
            <li><a asp-controller="Home" asp-action="Index"> Yolcu </a></li>
            <li><a asp-controller="Home" asp-action="Admin"> Ana Sayfa </a></li>
            <li><a asp-controller="Home" asp-action="Driver">Hakkımızda </a></li>
        </ul>
    </div>

    <div class="container">
        <header>Yolcu Rezarvasyon Sistemi</header>
        <form class="" id="form">

            <div class="form first">
                <div class="details personal">
                    <span class="title">Yolcu Bilgileri</span>
                    <div class="fields">
                        <div class="input-field">
                            <label for="isimSoyisim">İsim-Soyisim</label>
                            <input id="isimSoyisim" name="isimSoyisim" type="text" maxlength="25" placeholder="İsminizi ve Soyisminizi Giriniz" required>
                        </div>

                        <div class="input-field">
                            <label for="bday">Doğum Tarihi</label>
                            <input id="bday" name="bday" type="date" min="1950-01-01" max="2005-12-01" placeholder="Doğum tarihini giriniz" required>
                        </div>

                        <div class="input-field">
                            <label for="email">Email</label>
                            <input id="email" name="email" type="email" maxlength="40" placeholder="Email adresinizi giriniz"  required />
                        </div>

                        <div class="input-field">
                            <label for="phoneNumber">Telefon Numarası</label>
                            <input id="phoneNumber" name="phoneNumber" type="tel" pattern="\d{11}" maxlength="11" minlength="11" placeholder="Telefon numaranızı giriniz" required>
                        </div>

                        <div class="input-field">
                            <label for="tcNumber">TC Kimlik Numarası</label>
                            <input id="tcNumber" name="tcNumber" type="tel" pattern="\d{11}" maxlength="11" minlength="11" placeholder="TC Kimlik numaranızı giriniz" required>
                        </div>

                        <div class="input-field">
                            <label for="gender">Cinsiyet</label>
                            <select id="gender" name="gender" required>
                                <option disabled selected value="">Cinsiyetinizi giriniz</option>
                                <option value="0">Kadın</option>
                                <option value="1">Erkek</option>
                            </select>
                        </div>
                    </div>
                    <button class="nextBtn">
                        <span class="btnText" >Next</span>
                        <i class="uil uil-navigator"></i>
                    </button>
                                  
                </div>


            </div>

            <div class="form second">
                <span class="title">Yolculuk Bilgileri</span>

                <div class=" fields">
                    <div class="input-field2">
                        <label for="city">Şehir</label>
                        <select name="city" id="city" type="text" required>
                            <option value="">İL</option>
                        </select>
                    </div>
               
                    <div class="input-field2">
                        <label for="town">Başlangış İlçe</label>
                        <select id="town" name="town" type="text" required>
                            <option value="">İLÇE</option>
                        </select>
                    </div>

                    <div class="input-field2">
                        <label for="locality">Başlangıç Semt</label>
                        <select id="locality" name="locality" type="text" required>
                            <option value="">SEMT</option>
                        </select>
                    </div>

                    <div class="input-field2">
                        <label for="neighborhood">Başlangıç Mahalle</label>
                        <select id="neighborhood" name="neighborhood" type="text" required>
                            <option value="">MAHALLE</option>
                        </select>
                    </div>
                    
                    <div class="input-field2">
                        <label for="destinationTown">Varış ilçesi</label>
                        <select id="destinationtown" name="destinationTown" type="text" required>
                            <option value="">İLÇE</option>
                        </select>
                    </div>

                    <div class="input-field2">
                        <label for="destinationLacality">Varış Semti</label>
                        <select id="destinationlocality" name="destinationLocality" type="text" required>
                            <option value="">SEMT</option>
                        </select>
                    </div>

                    <div class="input-field2">
                        <label for="destinationNeighborhood">Varış Mahallesi</label>
                        <select id="destinationneighborhood" name="destinationNeighborhood" type="text" required>
                            <option value="">MAHALLE</option>
                        </select>
                    </div>

                    <div class="input-field2">
                        <label for="bookingTime">Rezervayon Saati</label>
                        <input id="bookingTime" name="bookingTime" type="time" placeholder="Saat Giriniz" required>

                    </div>

                    <div class="input-field2">
                        <label for="bookingDate">Rezervasyon Tarihi</label>
                        <input id="bookingDate" name="bookingDate" type="date" placeholder="Tarih giriniz" required>
                    </div>

                </div>
                <div class="buttons">
                    <div class="backBtn">
                        <i class="uil uil-navigator"></i>
                        <span class="btnText">Back</span>
                    </div>

                    <button type="button" id="submit" class="submit" onclick="btnSubmit()">
                        <span class="btnText">Submit</span>
                        <i class="uil uil-navigator"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</body>

    <script>


        function formkontrol() {

            let isimSoyisim = document.getElementById('isimSoyisim').value;
            let bday = document.getElementById('bday').value;
            let email = document.getElementById('email').value;
            let phoneNumber = document.getElementById('phoneNumber').value;
            let tcNumber = document.getElementById('tcNumber').value;
            let gender = document.getElementById('gender').value;
            
            if (!isimSoyisim || !bday || !email || !phoneNumber || !tcNumber || !gender) {
                alert('Lütfen tüm alanları doldurun');
                return false;
            }

            const phonePattern = /^\d{11}$/;
            if (!phonePattern.test(phoneNumber)) {
                alert('Telefon numarası 11 haneli olmalı ve sadece rakamlardan oluşmalıdır.');
                return false;
            }

            if (!phonePattern.test(tcNumber)) {
                alert('TC Kimlik numarası 11 haneli olmalı ve sadece rakamlardan oluşmalıdır.');
                return false;
            }

            return true;

        }

        function formkontrol2() {

            let city = document.getElementById('city').value;
            let town = document.getElementById('town').value;
            let locality = document.getElementById('locality').value;
            let neighborhood = document.getElementById('neighborhood').value;
            let destinationTown = document.getElementById('destinationtown').value;
            let destinationLocality = document.getElementById('destinationlocality').value;
            let destinationNeighborhood = document.getElementById('destinationneighborhood').value;
            let bookingTime = document.getElementById('bookingTime').value;
            let bookingDate = document.getElementById('bookingDate').value;

            if (!city || !town || !locality || !neighborhood || !destinationTown || !destinationLocality || !destinationNeighborhood || !bookingTime || !bookingDate) {
                alert('Lütfen tüm alanları doldurun');
                return false;
            }
            return true;
        }

    const bookingDateInput = document.getElementById('bookingDate');

    bookingDateInput.min = new Date().toISOString().slice(0, 10);
        

        const form = document.querySelector("form"),
          nextBtn = form.querySelector(".nextBtn"),
          backBtn = form.querySelector(".backBtn"),
          allInput = form.querySelectorAll(".input-field");

        nextBtn.addEventListener("click", () => {
            if (formkontrol()) {
                form.classList.add('secActive');
            }
            else {
                form.classList.remove('secActive');
            }
        });

        backBtn.addEventListener("click", () => form.classList.remove('secActive'));
        
        var citySettings = {
            "url": "https://localhost:44359/api/City/GetAllCity/",
            "method": "GET",
            "timeout": 0,
            "host": ""
        };

        $.ajax(citySettings).done(function (response) {
            var citySelect = $('#city'); 
            citySelect.empty(); 

            response.forEach(function (city) {
                citySelect.append($('<option></option>').attr('value', city.cityId).text(city.cityName));
            });
        });

        $('#city').change(function () {
            var selectedCityId = $(this).val(); 

            var townSettings = {
                "url": "https://localhost:44359/api/Town/GetOneTCityById/" + selectedCityId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(townSettings).done(function (response) {
                console.log(response);

                var townSelect = $('#town');
                townSelect.empty(); 

                response.forEach(function (town) {
                    townSelect.append($('<option></option>').attr('value', town.townId).text(town.townName));
                });
            });

        });
        $('#town').change(function () {
            var selectedTownId = $(this).val(); 

            var localitySettings = {
                "url": "https://localhost:44359/api/Locality/GetLocalityByTownId/" + selectedTownId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(localitySettings).done(function (response) {
                var localitySelect = $('#locality');
                localitySelect.empty();

                response.forEach(function (locality) {
                    localitySelect.append($('<option></option>').attr('value', locality.localityId).text(locality.localityName));
                });
            });
        });
        $('#locality').change(function () {
            var selectedLocalityId = $(this).val();

            var neighborhoodSettings = {
                "url": "https://localhost:44359/api/Neighborhood/GetNeighborhoodByLocalityId/" + selectedLocalityId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(neighborhoodSettings).done(function (response) {
                var neighborhoodSelect = $('#neighborhood'); 
                neighborhoodSelect.empty();

                response.forEach(function (neighborhood) {
                    neighborhoodSelect.append($('<option></option>').attr('value', neighborhood.neighborhoodId).text(neighborhood.neighborhoodName));
                });
            });
        });
        $('#city').change(function () {
            var selectedCityId = $(this).val();

            var townSettings = {
                "url": "https://localhost:44359/api/Town/GetOneTCityById/" + selectedCityId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(townSettings).done(function (response) {
                console.log(response); 

                var townSelect = $('#destinationtown');
                townSelect.empty();

                response.forEach(function (town) {
                    townSelect.append($('<option></option>').attr('value', town.townId).text(town.townName));
                });
            });
        });
        $('#destinationtown').change(function () {
            var selectedTownId = $(this).val();

            var localitySettings1 = {
                "url": "https://localhost:44359/api/Locality/GetLocalityByTownId/" + selectedTownId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(localitySettings1).done(function (response) {
                var localitySelect1 = $('#destinationlocality');
                localitySelect1.empty();

                response.forEach(function (locality) {
                    localitySelect1.append($('<option></option>').attr('value', locality.localityId).text(locality.localityName));
                });
            });
        });
        $('#destinationlocality').change(function () {
            var selectedLocalityId = $(this).val();

            var neighborhoodSettings1 = {
                "url": "https://localhost:44359/api/Neighborhood/GetNeighborhoodByLocalityId/" + selectedLocalityId,
                "method": "GET",
                "timeout": 0,
                "host": ""
            };

            $.ajax(neighborhoodSettings1).done(function (response) {
                var neighborhoodSelect1 = $('#destinationneighborhood');
                neighborhoodSelect1.empty();

                response.forEach(function (neighborhood) {
                    neighborhoodSelect1.append($('<option></option>').attr('value', neighborhood.neighborhoodId).text(neighborhood.neighborhoodName));
                });
            });
        });

    
        function btnSubmit() {


            if (!formkontrol2()) { 
                return;
            }
        

            var details = {
                detailsId: 0,
                name: $('#isimSoyisim').val(),
                bday: $('#bday').val(),
                tc: $('#tcNumber').val(),
                gender: $('#gender').val(),
                phoneNumber: $('#phoneNumber').val(),
                email: $('#email').val(),
            };

            var neighborhood = {
                neighborhoodName: $('#neighborhood').val(),
                locality: {
                    localityName: $('#locality').val(),
                    town: {
                        townName: $('#town').val(),
                        city: {
                            cityName: $('#city').val(),
                        }
                    }
                }
            };

        var bookingDate = $('#bookingDate').val(); // "YYYY-MM-DD" formatında tarih değeri
        var bookingTime = $('#bookingTime').val(); // "HH:MM" formatında saat değeri

        // bookingDate ve bookingTime değerlerini birleştirerek bookingDateTime oluştur
        var bookingDateTime = bookingDate + 'T' + bookingTime; // "YYYY-MM-DD HH:MM" formatında datetime değeri

        // request nesnesini oluştur
        var request = {
            "requestId": 0,
            "customerId": 0,
            "customer": {
                "customerId": 0,
                "detailsId": 0,
                "details": details
            },
            "neighborhoodId": $('#neighborhood').val(),
            "neighborhood": neighborhood,
            "destinationTown": $('#destinationtown').val(),
            "destinationLocality": $('#destinationlocality').val(),
            "destinationNeighborhood": $('#destinationneighborhood').val(),
            "bookingTime  ": bookingDateTime // birleştirilmiş datetime değerini JSON'a ekle
        };

        console.log(request);

            $.ajax({
                method: 'POST',
                url: 'https://localhost:44359/api/Request/CreateOneRequest/',
                contentType: 'application/json',
                data: JSON.stringify(request),
                success: function (response) {
                    console.log(request)
                    alert('Rezervasyon isteğiniz başarıyla alınmıştır. Olumlu olması durumunda mail ile iblgilendiliceksiniz...: ' + response);
                },
                error: function (jqXHR, error, errorThrown) {
                    console.log(request)
                    alert("hata");
                    alert(jqXHR.responseText);
                }
            });


        }

    </script>


</html>